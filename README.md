# Детектирование людей с дрона

Моя задача — создать нейросеть, детектирующую людей с дрона. Для выполнения данного задания у меня есть датасет HERIDAL (https://www.kaggle.com/datasets/imadeddinelassakeur/heridal)

-------------------------------------------------------------------------------------------------------------------------------------------
## Датасет и выбор архитектуры нейросети

Наш датасет - это фото с дрона разрешением 4000 на 3000. Эти фото сделаны с достаточно большого расстояния

Люди на этих фото очень маленькие, ресайз 4000x3000 в 640x640(т.к. Yolo v8) — идея ужасная, поэтому сразу же было понятно что фото надо разрезать. Фото резались на кропы 640x640 с пересечением в 320 пикселей. Пересечения были сделаны в том числе и для того, чтобы хоть чуть-чуть повысить количество фото, где есть люди, попавшие в кадр, так как во всем датасете преобладает фон и людей очень мало. 

Датасет создавал по такому алгоритму:
1) Все фото разделил на train+val и test в пропорции 85% на 15%. test больше не трогаем, будем тестить на изначальном размере. 
2) train+val разрезаем на кропы, при этом помечая, есть ли на каждом из кропов люди
3) Все кропы, на которых есть люди мы берем. Кропы без людей берем в пропорции количество_кропов_с_людьми * 0.4
4) Делим кропы с людьми в пропорции 85% train и 15% test и кропы без людей так же.

Нейросеть — Yolo v8m, выбрал так как это серединка по скорости/точности, если верить сайту ultralytics. 

Стоит отдельно поговорить про инференс. Я учил на кропах 640x640 поэтому и инференс надо делать на том же размере. То есть алгоритм таков: боксы придется предсказывать скользящим по фотке окном 640х640. И только после того как пройдет вся фотка, делать NMS для всех-всех боксов.

На гитхабе я нашел готовый фреймворк для этого дела https://github.com/obss/sahi/tree/main. Его собственно и использовал

Основная метрика на тесте - mAP50, метрику снимал при помощи встроенных в sahi функций https://github.com/obss/sahi/blob/main/docs/cli.md

-------------------------------------------------------------------------------------------------------------------------------------------
## Тренировка модели и тесты

Для мониторинга процесса тренировки использовал графики, которые Yolo сохраняет сама.
Графики лежат в папке readme_dir, metrics.png


### Результаты на тестовом датасете

Тесты проводились на изначальных фото 4000x3000

|           |           |
|-----------|--------------------|
| **mAP50** | 0.705  |

Примеры детекций в папке readme_dir, красные боксы - предсказанное, синие - истинные